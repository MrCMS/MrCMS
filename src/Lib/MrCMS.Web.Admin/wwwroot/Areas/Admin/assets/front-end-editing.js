(()=>{let e,t,n,a,i,o,r,c,d;function s(e){e.preventDefault(),e.stopPropagation()}async function l(e){const t=e.target,n=t.dataset.original,a=w(t.innerHTML);if(n!==a){const e={key:t.dataset.key,value:t.innerHTML?.trim()??""};await L(e,t),t.dataset.original=a}}async function m(e){const t=e.target,n=t.dataset.original,a=w(t.innerHTML);if(n!==a){const e={id:t.dataset.id,entityProperty:t.dataset.property,entityType:t.dataset.type,content:a?.trim()??""};await p(e,t),t.dataType.original=a}}async function u(e){const t=e.editor.element.$;let n=w(e.editor.getData());if(t.dataset.original!==n){const e={key:t.dataset.key,value:n?.trim()??""};await L(e,t),t.dataset.original=n}else await A(t)}async function y(e){const t=e.editor.element.$;let n=w(e.editor.getData());if(t.dataset.original!==n){const e={id:t.dataset.id,entityProperty:t.dataset.property,entityType:t.dataset.type,content:n?.trim()??""};await p(e,t),t.data.original=n}else await h(t)}async function g(e){const t=e.editor.element.$;await fetch("/Admin/InPageAdmin/GetUnformattedStringResource/?"+new URLSearchParams({key:t.dataset.key})).then((e=>e.text())).then((n=>{e.editor.setData(n),t.dataset.original=e.editor.getData()}))}async function f(e){console.log({e:e});const t=e.editor.element.$;await fetch("/Admin/InPageAdmin/GetUnformattedContent/?"+new URLSearchParams({id:t.dataset.id,property:t.dataset.property,type:t.dataset.type})).then((e=>e.text())).then((n=>{e.editor.setData(n),t.dataset.original=e.editor.getData()}))}async function p(e,t){await fetch("/Admin/InPageAdmin/SaveContent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{let n=document.getElementById("save-content-msg");!1===e.success?(n.innerText="An error occured.",alert(e.message)):(h(t),n.innerText="Saved.",n.style.display="inline-block",setTimeout((function(){n.style.display="none"}),500))})).catch((e=>{console.error("Error:",e)}))}function b(){t.classList.add("editing-on"),E(!0),a&&(a.innerText="Inline: On",a.classList.add("mrcms-btn-warning")),e.forEach((e=>e.classList.add("layout-area-enabled")));let p=document.querySelectorAll(n);for(const e of p){const t=e;if("true"!==t.getAttribute("contenteditable")&&t.setAttribute("contenteditable","true"),"string-resource"===t.dataset.type)if("true"===t.dataset.isHtml){const e=parent.CKEDITOR.inline(t);e.on("focus",g),e.on("blur",u)}else t.dataset.original=t.innerHTML,t.removeEventListener("click",s),t.addEventListener("click",s),t.removeEventListener("blur",l),t.addEventListener("blur",l);else if("true"===t.dataset.isHtml){const e=parent.CKEDITOR.inline(t);e.on("focus",f),e.on("blur",y)}else t.dataset.original=t.innerHTML,t.removeEventListener("click",s),t.addEventListener("click",s),t.removeEventListener("blur",m),t.addEventListener("blur",m)}document.querySelectorAll("div[data-widget-id]").forEach((e=>{e.insertAdjacentHTML("afterbegin","<div class='edit-indicator-widget' style='diaply:none;'><img src='/Areas/Admin/Content/img/pencil.png' /></div>")})),document.querySelectorAll("div[data-layout-area-id]").forEach((e=>{let t="";t=0===e.offsetHeight?"<div class='edit-indicator-layout corner'><img src='/Areas/Admin/Content/img/layout-2.png' /></div>":"<div class='edit-indicator-layout'><img src='/Areas/Admin/Content/img/layout-1.png' /></div>",e.insertAdjacentHTML("afterbegin",t)})),document.querySelectorAll("div[data-content-block-id]").forEach((e=>{e.insertAdjacentHTML("afterbegin","<div class='edit-indicator-content-block' style='position: absolute;cursor: pointer;z-index: 9999;'><img src='/Areas/Admin/Content/img/pencil.png' /></div>")})),o=document.querySelectorAll(".edit-indicator-widget"),r=document.querySelectorAll(".edit-widget-menu"),c=document.querySelectorAll(".edit-layout-area-menu"),i=document.querySelectorAll(".edit-indicator-layout"),d=document.querySelectorAll(".edit-indicator-content-block"),o.forEach((e=>e.style.display="block")),i.forEach((e=>e.style.display="block")),d.forEach((e=>e.addEventListener("click",(function(t){let n="[data-content-block-menu='"+e.parentElement.dataset.contentBlockId+"']",a=document.querySelectorAll(n)[0];a.style.display="block",t.stopPropagation(),document.addEventListener("click",(function(e){a&&!a.contains(e.target)&&(a.style.display="none")}))})))),o.forEach((e=>e.addEventListener("click",(function(e){let t=e.target.parentElement.parentElement;const n=t.dataset.widgetId,a=`<div class="mrcms-edit-menu mrcms-edit-widget"><h4>${t.dataset.widgetName}</h4><ul><li><a id="" href="/Admin/Widget/Edit/${n}?returnUrl=${window.top.location}" target="_parent" class="mrcms-btn mrcms-btn-mini mrcms-btn-primary">Edit</a></li><li><a id="" href="/Admin/Widget/Delete/${n}" target="_parent" class="mrcms-btn mrcms-btn-mini mrcms-btn-danger">Delete</a></li></ul></div>`;t.parentElement.insertAdjacentHTML("afterbegin",a);let i=document.querySelectorAll(".mrcms-edit-widget")[0];i.style.display="block",e.stopPropagation(),document.addEventListener("click",(function(e){i&&!i.contains(e.target)&&i.remove()}))})))),i.forEach((e=>e.addEventListener("click",(function(e){let t=e.target.parentElement.parentElement;const n=t.dataset.layoutAreaId,a=`<div class="mrcms-edit-menu mrcms-edit-layout-area"><h4>${t.dataset.layoutAreaName}</h4><ul><li><a tab-index="1" href="/Admin/Widget/Add?pageId=${document.querySelectorAll("[data-webpage-id]")[0].dataset.webpageId}&id=${n}" data-toggle="fb-modal" class="mrcms-btn mrcms-btn-mini mrcms-btn-primary">Add widget</a></li><li><a tab-index="3" href="/Admin/LayoutArea/SortWidgets/${n}?returnUrl=${top.location.href}" class="mrcms-btn mrcms-btn-mini mrcms-btn-secondary" data-toggle="fb-modal">Sort widgets</a></li></ul></div>`;t.insertAdjacentHTML("afterbegin",a);let i=document.querySelectorAll(".mrcms-edit-layout-area")[0];i.style.display="block",e.stopPropagation(),document.addEventListener("click",(function(e){i&&!i.contains(e.target)&&i.remove()}));let o=document.querySelectorAll("[data-action=post-link]")[0];o&&o.addEventListener("click",(function(e){e.stopPropagation();const t=$(this),n=t.attr("href")||t.data("link");null!=n&&window.postToUrl(n,{})}))}))))}async function h(e){let t="/Admin/InPageAdmin/GetFormattedContent";t+="?";let n={id:e.dataset.id,property:e.dataset.property,type:e.dataset.type};for(let e in n)t+=e+"="+n[e]+"&";t=encodeURI(t.slice(0,-1)),await fetch(t).then((function(e){return e.text()})).then((function(t){e.innerHTML=t})).catch((function(e){console.warn("Something went wrong.",e)}))}async function A(e){let t=[];if(e.dataset.replacements){let n=JSON.parse(e.dataset.replacements);for(const[e,a]of Object.entries(n))t.push({Key:e,Value:a})}let n="/Admin/InPageAdmin/GetFormattedStringResource?"+new URLSearchParams({key:e.dataset.key});n=encodeURI(n),await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(e){return e.text()})).then((function(t){e.innerHTML=t})).catch((function(e){console.warn("Something went wrong.",e)}))}function v(){return"true"===localStorage.getItem("mrcms-inline-edit")}function E(e){localStorage.setItem("mrcms-inline-edit",e)}function w(e){return e?.replace(/^\s*(?:<br\s*\/?\s*>)+|(?:<br\s*\/?\s*>)+\s*$/g,"")}async function L(e,t){await fetch("/Admin/InPageAdmin/SaveStringResource",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((async e=>{let n=document.getElementById("save-content-msg");!1===e.success?(n.innerText="An error occured.",alert(e.message)):(await A(t),n.innerText="Saved.",n.style.display="inline-block",setTimeout((function(){n.style.display="none"}),500))})).catch((e=>{console.error("Error:",e)}))}document.addEventListener("DOMContentLoaded",(function(){!function(){e=document.querySelectorAll(".layout-area"),t=document.getElementsByTagName("body")[0],n=".editable",a=document.getElementById("enable-editing"),CKEDITOR.config.allowedContent=!0,parent.CKEDITOR.disableAutoInline=!0,parent.CKEDITOR.on("instanceCreated",(function(e){const t=e.editor;t.on("configLoaded",(function(){t.config.toolbar="Basic"}))})),a&&a?.addEventListener("click",(async function(){v()?await async function(){E(!1),t.classList.remove("editing-on"),e.forEach((e=>e.classList.remove("layout-area-enabled"))),a&&(a.innerText="Inline: Off",a.classList.remove("mrcms-btn-warning"));i.forEach((e=>e.remove())),o.forEach((e=>e.remove())),r.forEach((e=>e.remove())),c.forEach((e=>e.remove())),d.forEach((e=>e.remove()));for(const e of document.querySelectorAll(n))"true"===e.dataset.isHtml&&("string-resource"===e.dataset.type?await A(e):await h(e));document.querySelectorAll(n).forEach((e=>e.setAttribute("contenteditable","false"))),function(){let e=parent.CKEDITOR.instances;if(e)for(let t in e){parent.CKEDITOR.instances[t].destroy(!0)}}()}():b()}));!0===v()&&b();t.classList.add("mrcms-admin-bar-on")}()}))})();
//# sourceMappingURL=front-end-editing.js.map
