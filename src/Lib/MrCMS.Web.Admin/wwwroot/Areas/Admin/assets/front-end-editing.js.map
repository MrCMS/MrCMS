{"mappings":"MAAA,IAAIA,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EAqCJ,SAASC,EAAmBC,GACxBA,EAAEC,iBACFD,EAAEE,kBAGNC,eAAeC,EAAwBJ,GACnC,MAAMK,EAAKL,EAAEM,OACPC,EAAWF,EAAGG,QAAQD,SACtBE,EAAOC,EAA8BL,EAAGM,WAC9C,GAAIJ,IAAaE,EAAM,CACnB,MAAMG,EAAO,CACTC,IAAKR,EAAGG,QAAQK,IAChBC,MAAOT,EAAGM,WAAWI,QAAU,UAE7BC,EAAiBJ,EAAMP,GAC7BA,EAAGG,QAAQD,SAAWE,GAI9BN,eAAec,EAAuBjB,GAClC,MAAMK,EAAKL,EAAEM,OACPC,EAAWF,EAAGG,QAAQD,SACtBE,EAAOC,EAA8BL,EAAGM,WAC9C,GAAIJ,IAAaE,EAAM,CACnB,MAAMG,EAAO,CACTM,GAAIb,EAAGG,QAAQU,GACfC,eAAgBd,EAAGG,QAAQY,SAC3BC,WAAYhB,EAAGG,QAAQc,KACvBC,QAASd,GAAMM,QAAU,UAEvBS,EAAeZ,EAAMP,GAC3BA,EAAGoB,SAASlB,SAAWE,GAI/BN,eAAeuB,EAAiB1B,GAC5B,MAAMK,EAAKL,EAAE2B,OAAOC,QAAQC,EAC5B,IAAIpB,EAAOC,EAA8BV,EAAE2B,OAAOG,WAClD,GAAIzB,EAAGG,QAAQD,WAAaE,EAAM,CAC9B,MAAMG,EAAO,CACTC,IAAKR,EAAGG,QAAQK,IAChBC,MAAOL,GAAMM,QAAU,UAErBC,EAAiBJ,EAAMP,GAC7BA,EAAGG,QAAQD,SAAWE,aAEhBsB,EAAiB1B,GAK/BF,eAAe6B,EAAgBhC,GAC3B,MAAMK,EAAKL,EAAE2B,OAAOC,QAAQC,EAC5B,IAAIpB,EAAOC,EAA8BV,EAAE2B,OAAOG,WAClD,GAAIzB,EAAGG,QAAQD,WAAaE,EAAM,CAC9B,MAAMG,EAAO,CACTM,GAAIb,EAAGG,QAAQU,GACfC,eAAgBd,EAAGG,QAAQY,SAC3BC,WAAYhB,EAAGG,QAAQc,KACvBC,QAASd,GAAMM,QAAU,UAEvBS,EAAeZ,EAAMP,GAC3BA,EAAGO,KAAKL,SAAWE,aAEbwB,EAAa5B,GAK3BF,eAAe+B,EAAiBlC,GAC5B,MAAMK,EAAKL,EAAE2B,OAAOC,QAAQC,QAEtBM,MAAM,oDAAsD,IAAIC,gBAAgB,CAClFvB,IAAKR,EAAGG,QAAQK,OAChBwB,MAAKC,GAAYA,EAASC,SAAQF,MAAKzB,IACvCZ,EAAE2B,OAAOa,QAAQ5B,GACjBP,EAAGG,QAAQD,SAAWP,EAAE2B,OAAOG,aAIvC3B,eAAesC,EAAgBzC,GAC3B0C,QAAQC,IAAI,C,EAAC3C,IACb,MAAMK,EAAKL,EAAE2B,OAAOC,QAAQC,QACtBM,MAAM,6CAA+C,IAAIC,gBAAgB,CAC3ElB,GAAIb,EAAGG,QAAQU,GACfE,SAAUf,EAAGG,QAAQY,SACrBE,KAAMjB,EAAGG,QAAQc,QACjBe,MAAKC,GAAYA,EAASC,SAAQF,MAAKzB,IACvCZ,EAAE2B,OAAOa,QAAQ5B,GACjBP,EAAGG,QAAQD,SAAWP,EAAE2B,OAAOG,aAIvC3B,eAAeqB,EAAeoB,EAAMvC,SAC1B8B,MAAM,iCAAkC,CAC1CU,OAAQ,OACRC,QAAS,CACL,eAAgB,oBAEpBC,KAAMC,KAAKC,UAAUL,KAEpBP,MAAKC,GAAYA,EAASY,SAC1Bb,MAAKzB,IACF,IAAIuC,EAAQC,SAASC,eAAe,qBACf,IAAjBzC,EAAK0C,SACLH,EAAMI,UAAY,oBAClBC,MAAM5C,EAAK6C,WAEXxB,EAAa5B,GACb8C,EAAMI,UAAY,SAClBJ,EAAMO,MAAMC,QAAU,eAEtBC,YAAW,WACPT,EAAMO,MAAMC,QAAU,SACvB,SAGVE,OAAOC,IACJpB,QAAQoB,MAAM,SAAUA,MAIpC,SAASC,IACLxE,EAAayE,UAAUC,IAAI,cAC3BC,GAAkB,GAEdzE,IACAA,EAAiB8D,UAAY,aAC7B9D,EAAiBuE,UAAUC,IAAI,sBAGnC3E,EAAY6E,SAAQC,GAAKA,EAAEJ,UAAUC,IAAI,yBAEzC,IAAII,EAAUjB,SAASkB,iBAAiB9E,GACxC,IAAK,MAAM+E,KAAKF,EAAS,CACrB,MAAMhE,EAAKkE,EAKX,GAJ2C,SAAvClE,EAAGmE,aAAa,oBAChBnE,EAAGoE,aAAa,kBAAmB,QAGf,oBAApBpE,EAAGG,QAAQc,KACX,GAA0B,SAAtBjB,EAAGG,QAAQkE,OAAmB,CAC9B,MAAM/C,EAASgD,OAAOC,SAASC,OAAOxE,GACtCsB,EAAOmD,GAAG,QAAS5C,GAGnBP,EAAOmD,GAAG,OAAQpD,QAGlBrB,EAAGG,QAAQD,SAAWF,EAAGM,UAEzBN,EAAG0E,oBAAoB,QAAShF,GAChCM,EAAG2E,iBAAiB,QAASjF,GAE7BM,EAAG0E,oBAAoB,OAAQ3E,GAC/BC,EAAG2E,iBAAiB,OAAQ5E,QAKhC,GAA0B,SAAtBC,EAAGG,QAAQkE,OAAmB,CAC9B,MAAM/C,EAASgD,OAAOC,SAASC,OAAOxE,GACtCsB,EAAOmD,GAAG,QAASrC,GACnBd,EAAOmD,GAAG,OAAQ9C,QAGlB3B,EAAGG,QAAQD,SAAWF,EAAGM,UAEzBN,EAAG0E,oBAAoB,QAAShF,GAChCM,EAAG2E,iBAAiB,QAASjF,GAE7BM,EAAG0E,oBAAoB,OAAQ9D,GAC/BZ,EAAG2E,iBAAiB,OAAQ/D,GAQxCmC,SAASkB,iBAAiB,uBAAuBH,SAAQC,IAErDA,EAAEa,mBAAmB,aADV,sHAIf7B,SAASkB,iBAAiB,4BAA4BH,SAAQC,IAC1D,IAAI3D,EAAO,GAEPA,EADmB,IAAnB2D,EAAEc,aACK,sGAEA,+FAEXd,EAAEa,mBAAmB,aAAcxE,MAGvC2C,SAASkB,iBAAiB,8BAA8BH,SAAQC,IAE5DA,EAAEa,mBAAmB,aADV,kKAIftF,EAAuByD,SAASkB,iBAAiB,0BACjD1E,EAA2BwD,SAASkB,iBAAiB,qBACrDzE,EAA2BuD,SAASkB,iBAAiB,0BACrD5E,EAAuB0D,SAASkB,iBAAiB,0BACjDxE,EAA6BsD,SAASkB,iBAAiB,iCACvD3E,EAAqBwE,SAAQC,GAAKA,EAAEV,MAAMC,QAAU,UACpDjE,EAAqByE,SAAQC,GAAKA,EAAEV,MAAMC,QAAU,UAEpD7D,EAA2BqE,SAAQC,GAAKA,EAAEY,iBAAiB,SAAS,SAAUG,GAC1E,IACIC,EAAe,6BADLhB,EAAEiB,cAAc7E,QAAQ8E,eACsB,KACxDC,EAAOnC,SAASkB,iBAAiBc,GAAc,GACnDG,EAAK7B,MAAMC,QAAU,QACrBwB,EAAMjF,kBACNkD,SAAS4B,iBAAiB,SAAS,SAAUhF,GACrCuF,IAASA,EAAKC,SAASxF,EAAEM,UACzBiF,EAAK7B,MAAMC,QAAU,gBAMjChE,EAAqBwE,SAAQsB,GAAKA,EAAET,iBAAiB,SAAS,SAAUZ,GACpE,IAAI/D,EAAK+D,EAAE9D,OAAO+E,cAAcA,cAChC,MAAMK,EAAWrF,EAAGG,QAAQkF,SAEtBH,EAAO,sDADAlF,EAAGG,QAAQmF,4DACiGD,eAAsBE,OAAOC,IAAIC,sIAAsIJ,mGAEhSrF,EAAGgF,cAAcJ,mBAAmB,aAAcM,GAClD,IAAIQ,EAAc3C,SAASkB,iBAAiB,sBAAsB,GAElEyB,EAAYrC,MAAMC,QAAU,QAC5BS,EAAElE,kBAEFkD,SAAS4B,iBAAiB,SAAS,SAAUhF,GACrC+F,IAAgBA,EAAYP,SAASxF,EAAEM,SACvCyF,EAAYC,iBAKxBtG,EAAqByE,SAAQ8B,GAAKA,EAAEjB,iBAAiB,SAAS,SAAUZ,GACpE,IAAI/D,EAAK+D,EAAE9D,OAAO+E,cAAcA,cAChC,MAAMa,EAAS7F,EAAGG,QAAQ2F,aAGpBZ,EAAO,2DAFIlF,EAAGG,QAAQ4F,8EACbhD,SAASkB,iBAAiB,qBAAqB,GAAG9D,QAAQ6F,gBACoFH,4JAAiKA,eAAoBL,IAAIC,SAASQ,qHAC/VjG,EAAG4E,mBAAmB,aAAcM,GACpC,IAAIQ,EAAc3C,SAASkB,iBAAiB,2BAA2B,GACvEyB,EAAYrC,MAAMC,QAAU,QAC5BS,EAAElE,kBACFkD,SAAS4B,iBAAiB,SAAS,SAAUhF,GACrC+F,IAAgBA,EAAYP,SAASxF,EAAEM,SACvCyF,EAAYC,YAGpB,IAAIO,EAAkBnD,SAASkB,iBAAiB,2BAA2B,GACvEiC,GACAA,EAAgBvB,iBAAiB,SAAS,SAAUhF,GAChDA,EAAEE,kBACF,MAAMsG,EAAO3E,EAAE4E,MACTC,EAAMF,EAAKG,KAAK,SAAWH,EAAK5F,KAAK,QAChC,MAAP8F,GACAd,OAAOgB,UAAUF,EAAK,YA8C1CvG,eAAe8B,EAAa5B,GACxB,IAAIqG,EAAM,yCACVA,GAAO,IACP,IAAI9F,EAAO,CACPM,GAAIb,EAAGG,QAAQU,GACfE,SAAUf,EAAGG,QAAQY,SACrBE,KAAMjB,EAAGG,QAAQc,MAErB,IAAK,IAAIuF,KAAKjG,EACV8F,GAAOG,EAAI,IAAMjG,EAAKiG,GAAK,IAE/BH,EAAMI,UAAUJ,EAAIK,MAAM,GAAG,UACvB5E,MAAMuE,GAAKrE,MAAK,SAAUC,GAC5B,OAAOA,EAASC,UACjBF,MAAK,SAAUC,GACdjC,EAAGM,UAAY2B,KAIhBuB,OAAM,SAAUmD,GAEftE,QAAQuE,KAAK,wBAAyBD,MAI9C7G,eAAe4B,EAAiB1B,GAE5B,IAAI6G,EAAa,GAEjB,GAAI7G,EAAGG,QAAQ2G,aAAc,CACzB,IAAIC,EAAgBpE,KAAKqE,MAAMhH,EAAGG,QAAQ2G,cAC1C,IAAK,MAAOtG,EAAKC,KAAUwG,OAAOC,QAAQH,GACtCF,EAAWM,KAAK,CACZC,IAAK5G,EACL6G,MAAO5G,IAKnB,IAAI4F,EAAM,iDAAmD,IAAItE,gBAAgB,CAC7EvB,IAAKR,EAAGG,QAAQK,MAGpB6F,EAAMI,UAAUJ,SACVvE,MAAMuE,EAAK,CACb7D,OAAQ,OACRC,QAAS,CACL,eAAgB,oBAEpBC,KAAMC,KAAKC,UAAUiE,KACtB7E,MAAK,SAAUC,GACd,OAAOA,EAASC,UACjBF,MAAK,SAAUC,GACdjC,EAAGM,UAAY2B,KAIhBuB,OAAM,SAAUmD,GAEftE,QAAQuE,KAAK,wBAAyBD,MAI9C,SAASW,IACL,MAAqD,SAA9CC,aAAaC,QAAQ,qBAGhC,SAAS3D,EAAkBpD,GACvB8G,aAAaE,QAAQ,oBAAqBhH,GAO9C,SAASJ,EAA8BqH,GACnC,OAAOA,GAAKC,QAAO,iDAAmD,IAG1E7H,eAAea,EAAiBiH,EAAM5H,SAC5B8B,MAAM,wCAAyC,CACjDU,OAAQ,OACRC,QAAS,CACL,eAAgB,oBAEpBC,KAAMC,KAAKC,UAAUgF,KAEpB5F,MAAKC,GAAYA,EAASY,SAC1Bb,MAAKlC,MAAMS,IACR,IAAIuC,EAAQC,SAASC,eAAe,qBACf,IAAjBzC,EAAK0C,SACLH,EAAMI,UAAY,oBAClBC,MAAM5C,EAAK6C,iBAEL1B,EAAiB1B,GACvB8C,EAAMI,UAAY,SAClBJ,EAAMO,MAAMC,QAAU,eAEtBC,YAAW,WACPT,EAAMO,MAAMC,QAAU,SACvB,SAGVE,OAAOC,IACJpB,QAAQoB,MAAM,SAAUA,MAhcpCV,SAAS4B,iBAAiB,oBAAoB,YAI9C,WACI1F,EAAc8D,SAASkB,iBAAiB,gBACxC/E,EAAe6D,SAAS8E,qBAAqB,QAAQ,GACrD1I,EAAmB,YACnBC,EAAmB2D,SAASC,eAAe,kBAC3CuB,SAASuD,OAAOC,gBAAiB,EACjCzD,OAAOC,SAASyD,mBAAoB,EACpC1D,OAAOC,SAASE,GAAG,mBAAmB,SAAUK,GAC5C,MAAMxD,EAASwD,EAAMxD,OACrBA,EAAOmD,GAAG,gBAAgB,WACtBnD,EAAOwG,OAAOG,QAAU,cAI5B7I,GACAA,GAAkBuF,iBAAiB,SAAS7E,iBACnCwH,UA6RjBxH,iBACI+D,GAAkB,GAClB3E,EAAayE,UAAUgC,OAAO,cAC9B1G,EAAY6E,SAAQC,GAAKA,EAAEJ,UAAUgC,OAAO,yBAExCvG,IACAA,EAAiB8D,UAAY,cAC7B9D,EAAiBuE,UAAUgC,OAAO,sBAGtCtG,EAAqByE,SAAQC,GAAKA,EAAE4B,WACpCrG,EAAqBwE,SAAQC,GAAKA,EAAE4B,WACpCpG,EAAyBuE,SAAQC,GAAKA,EAAE4B,WACxCnG,EAAyBsE,SAAQC,GAAKA,EAAE4B,WACxClG,EAA2BqE,SAAQC,GAAKA,EAAE4B,WAC1C,IAAK,MAAMuC,KAAKnF,SAASkB,iBAAiB9E,GACb,SAArB+I,EAAE/H,QAAQkE,SACa,oBAAnB6D,EAAE/H,QAAQc,WACJS,EAAiBwG,SAEjBtG,EAAasG,IAI/BnF,SAASkB,iBAAiB9E,GAAkB2E,SAAQnE,GAAKA,EAAEyE,aAAa,kBAAmB,WAI/F,WAEI,IAAI+D,EAAY7D,OAAOC,SAAS4D,UAChC,GAAIA,EACA,IAAK,IAAI3B,KAAK2B,EAAW,CACJ7D,OAAOC,SAAS4D,UAAU3B,GAClC4B,SAAQ,IATzBC,GAnTkBC,GAFN5E,QAOgB,IAAxB4D,KACA5D,IAEJxE,EAAayE,UAAUC,IAAI,sBA9B3B2E,O","sources":["wwwroot/Areas/Admin/Content/scripts/front-end-editing.js"],"sourcesContent":["ï»¿let layoutAreas;\nlet documentBody;\nlet editableSelector;\nlet enableEditingBtn;\nlet editLayoutIndicators;\nlet editWidgetIndicators;\nlet editWidgetMenuIndicators;\nlet editLayoutMenuIndicators;\nlet editContentBlockIndicators;\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n    initEditing()\n});\n\nfunction initEditing() {\n    layoutAreas = document.querySelectorAll(\".layout-area\");\n    documentBody = document.getElementsByTagName(\"body\")[0];\n    editableSelector = \".editable\";\n    enableEditingBtn = document.getElementById(\"enable-editing\");\n    CKEDITOR.config.allowedContent = true;\n    parent.CKEDITOR.disableAutoInline = true;\n    parent.CKEDITOR.on('instanceCreated', function (event) {\n        const editor = event.editor;\n        editor.on('configLoaded', function () {\n            editor.config.toolbar = 'Basic';\n        });\n    });\n\n    if (enableEditingBtn) {\n        enableEditingBtn?.addEventListener(\"click\", async function () {\n            if (!getEditingEnabled()) {\n                enableEditors();\n            } else {\n                await disableEditing();\n            }\n        });\n    }\n\n    if (getEditingEnabled() === true)\n        enableEditors();\n\n    documentBody.classList.add('mrcms-admin-bar-on');\n}\n\n\nfunction preventPropagation(e) {\n    e.preventDefault();\n    e.stopPropagation();\n}\n\nasync function saveResourceWhenChanged(e) {\n    const el = e.target;\n    const original = el.dataset.original;\n    const html = stripLeadingAndTrailingBrTags(el.innerHTML);\n    if (original !== html) {\n        const data = {\n            key: el.dataset.key,\n            value: el.innerHTML?.trim() ?? ''\n        }\n        await saveResourceEdit(data, el);\n        el.dataset.original = html;\n    }\n}\n\nasync function saveContentWhenChanged(e) {\n    const el = e.target;\n    const original = el.dataset.original;\n    const html = stripLeadingAndTrailingBrTags(el.innerHTML);\n    if (original !== html) {\n        const data = {\n            id: el.dataset.id,\n            entityProperty: el.dataset.property,\n            entityType: el.dataset.type,\n            content: html?.trim() ?? ''\n        }\n        await saveInlineEdit(data, el)\n        el.dataType.original = html;\n    }\n}\n\nasync function saveHtmlResource(e) {\n    const el = e.editor.element.$;\n    let html = stripLeadingAndTrailingBrTags(e.editor.getData());\n    if (el.dataset.original !== html) {\n        const data = {\n            key: el.dataset.key,\n            value: html?.trim() ?? ''\n        }\n        await saveResourceEdit(data, el)\n        el.dataset.original = html\n    } else {\n        await showLiveResource(el);\n    }\n}\n\n\nasync function saveHtmlContent(e) {\n    const el = e.editor.element.$;\n    let html = stripLeadingAndTrailingBrTags(e.editor.getData());\n    if (el.dataset.original !== html) {\n        const data = {\n            id: el.dataset.id,\n            entityProperty: el.dataset.property,\n            entityType: el.dataset.type,\n            content: html?.trim() ?? ''\n        }\n        await saveInlineEdit(data, el)\n        el.data.original = html;\n    } else {\n        await showLiveForm(el);\n    }\n}\n\n\nasync function loadHtmlResource(e) {\n    const el = e.editor.element.$;\n\n    await fetch('/Admin/InPageAdmin/GetUnformattedStringResource/?' + new URLSearchParams({\n        key: el.dataset.key,\n    })).then(response => response.text()).then(data => {\n        e.editor.setData(data);\n        el.dataset.original = e.editor.getData();\n    })\n}\n\nasync function loadHtmlContent(e) {\n    console.log({e});\n    const el = e.editor.element.$;\n    await fetch('/Admin/InPageAdmin/GetUnformattedContent/?' + new URLSearchParams({\n        id: el.dataset.id,\n        property: el.dataset.property,\n        type: el.dataset.type\n    })).then(response => response.text()).then(data => {\n        e.editor.setData(data);\n        el.dataset.original = e.editor.getData();\n    })\n}\n\nasync function saveInlineEdit(data, el) {\n    await fetch('/Admin/InPageAdmin/SaveContent', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n    })\n        .then(response => response.json())\n        .then(data => {\n            let msgEl = document.getElementById(\"save-content-msg\");\n            if (data.success === false) {\n                msgEl.innerText = \"An error occured.\"\n                alert(data.message);\n            } else {\n                showLiveForm(el);\n                msgEl.innerText = \"Saved.\"\n                msgEl.style.display = 'inline-block';\n\n                setTimeout(function () {\n                    msgEl.style.display = 'none';\n                }, 500)\n            }\n        })\n        .catch((error) => {\n            console.error('Error:', error);\n        });\n}\n\nfunction enableEditors() {\n    documentBody.classList.add(\"editing-on\");\n    setEditingEnabled(true);\n\n    if (enableEditingBtn) {\n        enableEditingBtn.innerText = \"Inline: On\";\n        enableEditingBtn.classList.add(\"mrcms-btn-warning\");\n    }\n\n    layoutAreas.forEach(x => x.classList.add('layout-area-enabled'));\n\n    let editors = document.querySelectorAll(editableSelector);\n    for (const x of editors) {\n        const el = x;\n        if (el.getAttribute('contenteditable') !== 'true')\n            el.setAttribute('contenteditable', 'true');\n\n        //check if type is string-resource\n        if (el.dataset.type === \"string-resource\") {\n            if (el.dataset.isHtml === 'true') {\n                const editor = parent.CKEDITOR.inline(el);\n                editor.on('focus', loadHtmlResource);\n\n\n                editor.on('blur', saveHtmlResource);\n\n            } else {\n                el.dataset.original = el.innerHTML;\n\n                el.removeEventListener('click', preventPropagation);\n                el.addEventListener(\"click\", preventPropagation);\n\n                el.removeEventListener('blur', saveResourceWhenChanged);\n                el.addEventListener(\"blur\", saveResourceWhenChanged);\n\n            }\n\n        } else {\n            if (el.dataset.isHtml === 'true') {\n                const editor = parent.CKEDITOR.inline(el);\n                editor.on('focus', loadHtmlContent);\n                editor.on('blur', saveHtmlContent);\n\n            } else {\n                el.dataset.original = el.innerHTML\n\n                el.removeEventListener('click', preventPropagation);\n                el.addEventListener(\"click\", preventPropagation);\n\n                el.removeEventListener('blur', saveContentWhenChanged);\n                el.addEventListener(\"blur\", saveContentWhenChanged);\n\n            }\n        }\n    }\n\n\n    //foreach widget add edit indicator\n    document.querySelectorAll(\"div[data-widget-id]\").forEach(x => {\n        let html = \"<div class='edit-indicator-widget' style='diaply:none;'><img src='/Areas/Admin/Content/img/pencil.png' /></div>\";\n        x.insertAdjacentHTML('afterbegin', html);\n    })\n    //foreach layout area add edit indicator\n    document.querySelectorAll(\"div[data-layout-area-id]\").forEach(x => {\n        let html = \"\";\n        if (x.offsetHeight === 0) {\n            html = \"<div class='edit-indicator-layout corner'><img src='/Areas/Admin/Content/img/layout-2.png' /></div>\";\n        } else {\n            html = \"<div class='edit-indicator-layout'><img src='/Areas/Admin/Content/img/layout-1.png' /></div>\";\n        }\n        x.insertAdjacentHTML('afterbegin', html);\n    })\n\n    document.querySelectorAll(\"div[data-content-block-id]\").forEach(x => {\n        let html = \"<div class='edit-indicator-content-block' style='position: absolute;cursor: pointer;z-index: 9999;'><img src='/Areas/Admin/Content/img/pencil.png' /></div>\";\n        x.insertAdjacentHTML('afterbegin', html);\n    })\n\n    editWidgetIndicators = document.querySelectorAll('.edit-indicator-widget');\n    editWidgetMenuIndicators = document.querySelectorAll('.edit-widget-menu');\n    editLayoutMenuIndicators = document.querySelectorAll('.edit-layout-area-menu');\n    editLayoutIndicators = document.querySelectorAll('.edit-indicator-layout');\n    editContentBlockIndicators = document.querySelectorAll('.edit-indicator-content-block');\n    editWidgetIndicators.forEach(x => x.style.display = 'block');\n    editLayoutIndicators.forEach(x => x.style.display = 'block');\n\n    editContentBlockIndicators.forEach(x => x.addEventListener('click', function (event) {\n        let blockId = x.parentElement.dataset.contentBlockId;\n        let menuSelector = \"[data-content-block-menu='\" + blockId + \"']\";\n        let menu = document.querySelectorAll(menuSelector)[0];\n        menu.style.display = 'block';\n        event.stopPropagation();\n        document.addEventListener('click', function (e) {\n            if (menu && !menu.contains(e.target)) {\n                menu.style.display = 'none';\n            }\n        });\n    }));\n\n    //create menu for widget editing\n    editWidgetIndicators.forEach(x => x.addEventListener('click', function (x) {\n        let el = x.target.parentElement.parentElement;\n        const widgetId = el.dataset.widgetId;\n        const name = el.dataset.widgetName;\n        const menu = `<div class=\"mrcms-edit-menu mrcms-edit-widget\"><h4>${name}</h4><ul><li><a id=\"\" href=\"/Admin/Widget/Edit/${widgetId}?returnUrl=${window.top.location}\" target=\"_parent\" class=\"mrcms-btn mrcms-btn-mini mrcms-btn-primary\">Edit</a></li><li><a id=\"\" href=\"/Admin/Widget/Delete/${widgetId}\" target=\"_parent\" class=\"mrcms-btn mrcms-btn-mini mrcms-btn-danger\">Delete</a></li></ul></div>`;\n\n        el.parentElement.insertAdjacentHTML('afterbegin', menu);\n        let menuElement = document.querySelectorAll('.mrcms-edit-widget')[0];\n\n        menuElement.style.display = 'block';\n        x.stopPropagation();\n\n        document.addEventListener('click', function (e) {\n            if (menuElement && !menuElement.contains(e.target)) {\n                menuElement.remove();\n            }\n        });\n    }));\n\n    editLayoutIndicators.forEach(x => x.addEventListener('click', function (x) {\n        let el = x.target.parentElement.parentElement;\n        const areaId = el.dataset.layoutAreaId;\n        const areaName = el.dataset.layoutAreaName;\n        const pageId = document.querySelectorAll(\"[data-webpage-id]\")[0].dataset.webpageId;\n        const menu = `<div class=\"mrcms-edit-menu mrcms-edit-layout-area\"><h4>${areaName}</h4><ul><li><a tab-index=\"1\" href=\"/Admin/Widget/Add?pageId=${pageId}&id=${areaId}\" data-toggle=\"fb-modal\" class=\"mrcms-btn mrcms-btn-mini mrcms-btn-primary\">Add widget</a></li><li><a tab-index=\"3\" href=\"/Admin/LayoutArea/SortWidgets/${areaId}?returnUrl=${top.location.href}\" class=\"mrcms-btn mrcms-btn-mini mrcms-btn-secondary\" data-toggle=\"fb-modal\">Sort widgets</a></li></ul></div>`;\n        el.insertAdjacentHTML('afterbegin', menu);\n        let menuElement = document.querySelectorAll('.mrcms-edit-layout-area')[0];\n        menuElement.style.display = 'block';\n        x.stopPropagation();\n        document.addEventListener('click', function (e) {\n            if (menuElement && !menuElement.contains(e.target)) {\n                menuElement.remove();\n            }\n        });\n        let postLinkElement = document.querySelectorAll(\"[data-action=post-link]\")[0];\n        if (postLinkElement) {\n            postLinkElement.addEventListener('click', function (e) {\n                e.stopPropagation();\n                const self = $(this);\n                const url = self.attr('href') || self.data('link');\n                if (url != null) {\n                    window.postToUrl(url, {});\n                }\n            });\n        }\n    }));\n}\n\nasync function disableEditing() {\n    setEditingEnabled(false);\n    documentBody.classList.remove(\"editing-on\");\n    layoutAreas.forEach(x => x.classList.remove('layout-area-enabled'));\n\n    if (enableEditingBtn) {\n        enableEditingBtn.innerText = \"Inline: Off\";\n        enableEditingBtn.classList.remove(\"mrcms-btn-warning\");\n    }\n\n    editLayoutIndicators.forEach(x => x.remove());\n    editWidgetIndicators.forEach(x => x.remove());\n    editWidgetMenuIndicators.forEach(x => x.remove());\n    editLayoutMenuIndicators.forEach(x => x.remove());\n    editContentBlockIndicators.forEach(x => x.remove());\n    for (const x of document.querySelectorAll(editableSelector)) {\n        if (x.dataset.isHtml === 'true') {\n            if (x.dataset.type === \"string-resource\") {\n                await showLiveResource(x);\n            } else {\n                await showLiveForm(x);\n            }\n        }\n    }\n    document.querySelectorAll(editableSelector).forEach(e => e.setAttribute(\"contenteditable\", \"false\"))\n    killCkeditors()\n}\n\nfunction killCkeditors() {\n    //kill all ckeditors\n    let instances = parent.CKEDITOR.instances;\n    if (instances) {\n        for (let k in instances) {\n            const instance = parent.CKEDITOR.instances[k];\n            instance.destroy(true);\n        }\n    }\n}\n\nasync function showLiveForm(el) {\n    let url = '/Admin/InPageAdmin/GetFormattedContent';\n    url += \"?\";\n    let data = {\n        id: el.dataset.id,\n        property: el.dataset.property,\n        type: el.dataset.type\n    };\n    for (let k in data) {\n        url += k + \"=\" + data[k] + \"&\";\n    }\n    url = encodeURI(url.slice(0, -1));\n    await fetch(url).then(function (response) {\n        return response.text();\n    }).then(function (response) {\n        el.innerHTML = response;\n        //let forms = el.querySelectorAll('form');\n        // $.validator.unobtrusive.parse(forms[0]);            $ is not defined\n\n    }).catch(function (err) {\n        // There was an error\n        console.warn('Something went wrong.', err);\n    });\n}\n\nasync function showLiveResource(el) {\n\n    let parameters = [];\n\n    if (el.dataset.replacements) {\n        let parameterJson = JSON.parse(el.dataset.replacements);\n        for (const [key, value] of Object.entries(parameterJson)) {\n            parameters.push({\n                Key: key,\n                Value: value\n            });\n        }\n    }\n\n    let url = '/Admin/InPageAdmin/GetFormattedStringResource?' + new URLSearchParams({\n        key: el.dataset.key\n    });\n\n    url = encodeURI(url);\n    await fetch(url, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(parameters),\n    }).then(function (response) {\n        return response.text();\n    }).then(function (response) {\n        el.innerHTML = response;\n        //let forms = el.querySelectorAll('form');\n        // $.validator.unobtrusive.parse(forms[0]);            $ is not defined\n\n    }).catch(function (err) {\n        // There was an error\n        console.warn('Something went wrong.', err);\n    });\n}\n\nfunction getEditingEnabled() {\n    return localStorage.getItem('mrcms-inline-edit') === 'true';\n}\n\nfunction setEditingEnabled(value) {\n    localStorage.setItem('mrcms-inline-edit', value);\n}\n\nfunction stripHtml(str) {\n    return str.replace(/(<([^>]+)>)/gi, \"\");\n}\n\nfunction stripLeadingAndTrailingBrTags(str) {\n    return str?.replace(/^\\s*(?:<br\\s*\\/?\\s*>)+|(?:<br\\s*\\/?\\s*>)+\\s*$/g, '');\n}\n\nasync function saveResourceEdit(data, el) {\n    await fetch('/Admin/InPageAdmin/SaveStringResource', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n    })\n        .then(response => response.json())\n        .then(async data => {\n            let msgEl = document.getElementById(\"save-content-msg\");\n            if (data.success === false) {\n                msgEl.innerText = \"An error occured.\"\n                alert(data.message);\n            } else {\n                await showLiveResource(el);\n                msgEl.innerText = \"Saved.\"\n                msgEl.style.display = 'inline-block';\n\n                setTimeout(function () {\n                    msgEl.style.display = 'none';\n                }, 500)\n            }\n        })\n        .catch((error) => {\n            console.error('Error:', error);\n        });\n}\n"],"names":["$4627d45762f573f2$var$layoutAreas","$4627d45762f573f2$var$documentBody","$4627d45762f573f2$var$editableSelector","$4627d45762f573f2$var$enableEditingBtn","$4627d45762f573f2$var$editLayoutIndicators","$4627d45762f573f2$var$editWidgetIndicators","$4627d45762f573f2$var$editWidgetMenuIndicators","$4627d45762f573f2$var$editLayoutMenuIndicators","$4627d45762f573f2$var$editContentBlockIndicators","$4627d45762f573f2$var$preventPropagation","e","preventDefault","stopPropagation","async","$4627d45762f573f2$var$saveResourceWhenChanged","el","target","original","dataset","html","$4627d45762f573f2$var$stripLeadingAndTrailingBrTags","innerHTML","data","key","value","trim","$4627d45762f573f2$var$saveResourceEdit","$4627d45762f573f2$var$saveContentWhenChanged","id","entityProperty","property","entityType","type","content","$4627d45762f573f2$var$saveInlineEdit","dataType","$4627d45762f573f2$var$saveHtmlResource","editor","element","$","getData","$4627d45762f573f2$var$showLiveResource","$4627d45762f573f2$var$saveHtmlContent","$4627d45762f573f2$var$showLiveForm","$4627d45762f573f2$var$loadHtmlResource","fetch","URLSearchParams","then","response","text","setData","$4627d45762f573f2$var$loadHtmlContent","console","log","data1","method","headers","body","JSON","stringify","json","msgEl","document","getElementById","success","innerText","alert","message","style","display","setTimeout","catch","error","$4627d45762f573f2$var$enableEditors","classList","add","$4627d45762f573f2$var$setEditingEnabled","forEach","x","editors","querySelectorAll","x1","getAttribute","setAttribute","isHtml","parent","CKEDITOR","inline","on","removeEventListener","addEventListener","insertAdjacentHTML","offsetHeight","event","menuSelector","parentElement","contentBlockId","menu","contains","x2","widgetId","widgetName","window","top","location","menuElement","remove","x3","areaId","layoutAreaId","layoutAreaName","webpageId","href","postLinkElement","self","this","url","attr","postToUrl","k","encodeURI","slice","err","warn","parameters","replacements","parameterJson","parse","Object","entries","push","Key","Value","$4627d45762f573f2$var$getEditingEnabled","localStorage","getItem","setItem","str","replace","data2","getElementsByTagName","config","allowedContent","disableAutoInline","toolbar","x4","instances","destroy","$4627d45762f573f2$var$killCkeditors","$4627d45762f573f2$var$disableEditing","$4627d45762f573f2$var$initEditing"],"version":3,"file":"front-end-editing.js.map"}