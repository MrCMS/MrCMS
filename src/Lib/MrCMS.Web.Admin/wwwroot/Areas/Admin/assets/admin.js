(()=>{function e(e,t,n){n=n||"post";var a=document.createElement("form");for(var i in a.setAttribute("method",n),a.setAttribute("action",e),a.setAttribute("id","temp-form"),t){var o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name",i),o.setAttribute("value",t[i]),a.appendChild(o)}let c=$("body").data("antiforgery-token");if(c){var l=document.createElement("input");l.setAttribute("type","hidden"),l.setAttribute("name","__RequestVerificationToken"),l.setAttribute("value",c),a.appendChild(l)}document.body.appendChild(a),a.submit()}function t(){$("[data-toggle=confirmation]").confirmation().on("click",(function(t){t.preventDefault(),function(t){const n=$(t).data("value"),a=$(t).data("id");e(n,{id:a})}(t.target)}))}function n(e){e.preventDefault();const t=$(e.target);$.get(this.href,(function(e){t.parents('div[data-paging-type="async"]').replaceWith(e)}))}function a(e){e.preventDefault();const t=$(e.target),n=t.parents('div[data-paging-type="async"]').find("input, select, textarea").serialize();return $.get($(this).data("url"),n,(function(e){t.parents('div[data-paging-type="async"]').replaceWith(e)})),!1}const i={type:"iframe",iframeWidth:800,afterOpen:function(){o(this.$instance)},beforeOpen:function(){},onResize:function(){this.autoHeight&&(this.$content.css("height","10px"),this.$content.css("height",this.$content.contents().find("body")[0].scrollHeight)),o(this.$instance)}};function o(e){const t=e.find(".featherlight-content").offset(),n=$(document).scrollTop();e.find(".featherlight-close-icon").css("top",t.top-n),e.find(".featherlight-close-icon").css("right",t.left-20)}function c(e){const t=$("<a>");t.attr("href",e),t.attr("data-toggle","fb-modal"),t.featherlight(i).click()}function l(){const e=$.extend({},i,{filter:'[data-toggle="fb-modal"]'});$(document).featherlight(e)}const s=function(e,t){const n=e;let a=$("body").data("antiforgery-token");const i=$.extend(r,t);let o;return{init:function(){o=this;const e=n.find(i.fileUploadSelector);if(e.length){const t=i.acceptFileTypes(n),c=n.find(i.uploadUrlSelector).val(),l=e.get()[0];let s=i.maxFilesize(n);try{window.Dropzone.forElement(l).destroy()}catch{}const r=new window.Dropzone(l,{url:c,acceptedFiles:t,timeout:12e4,maxFilesize:s,dictDefaultMessage:e.data("message"),parallelUploads:1,headers:{RequestVerificationToken:a}});r.on("queuecomplete",(function(e){i.onFileUploadStopped(e,r),n.find(i.progressBarSelector).hide(),$(document).trigger("update-area","media-folder")})),r.on("totaluploadprogress",this.progressBar),r.on("error",o.showMessage)}return o},progressBar:function(e,t,a){n.find(i.progressBarSelector).show(),n.find(i.progressBarSelectorInner).css("width",e+"%"),n.find(i.percentCompleteSelector).html(parseInt(e)+"%")},showMessage:function(e,t){noty({text:'<div class="notification-date">'+e.status+'</div><div class="notification-msg">'+t+"</div>",layout:"bottomRight",timeout:8e3,type:"error"})}}},r={fileUploadSelector:"#fileupload",acceptFileTypes:function(e){const t=e.find("#allowedFileTypes").val();return null!=t?t:".jpg, .png"},maxFilesize:function(e){const t=e.find("#maxFileSizeUpload").val();return null!=t?parseInt(t)/1024/1024:100},sequentialUploads:!0,progressBarSelector:"#progress",progressBarSelectorInner:"#progress .progress-bar",percentCompleteSelector:"#progress .progress-bar",filesSelector:"#mrcmsfiles",uploadUrlSelector:"#action-url",uploadMediaCategoryIdSelector:"#action-category-id",onFileUploadStopped:function(e){}};function d(){window.MediaUploader=s,window.MediaUploader.defaults=r}const u=s;function f(){CKEDITOR.replaceAll("ckedit-enabled"),CKEDITOR.on("instanceReady",(e=>{window.location!==window.parent.location&&top.$(top).trigger("resize")})),$("[data-type=media-selector], [class=media-selector]").mediaSelector(),d();const e=$("form");e.removeData("validator"),e.removeData("unobtrusiveValidation"),e.find("input, select").each(((e,t)=>{$.data(t,"previousValue",null)})),$.validator.unobtrusive.parse("form"),$(".system-tagging").tagit({autocomplete:{delay:250,minLength:1,source:function(e,t){var n,a;$.getJSON("/Admin/Tag/Search",{term:(a=e.term,(n=a,n.split(/,\s*/)).pop())},t)}},showAutocompleteOnFocus:!0,singleField:!0,placeholderText:"Start typing to add tags.",allowSpaces:!0}),$("[data-color-picker]").each((function(e,t){$(t).spectrum({preferredFormat:"hex",showInput:!0})})),$("form[data-are-you-sure]").each((function(e,t){const n=$(t);n.areYouSure({message:n.data("are-you-sure")})})),$("[data-sortable]").each(((e,t)=>{const n=$(t);n.sortable({update:function(e,t){n.find("li").each((function(e,t){$(t).find('[name*="Order"]').val(e)}))}})})),$(document).trigger("initialize-plugins",{})}function p(e){if(!e)return;if(void 0===e.classList)return;const t=e.hasClass("modal")?e:e.parents(".modal"),n=t.outerHeight(),a=$(window).outerHeight(),i=t.outerWidth(),o=(a-n)/2,c=($(window).outerWidth()-i)/2;t.css("top",o).css("left",c)}function m(e){let t;const n=jQuery.extend(m.defaults,e);let a,i,c,l;function s(e){e.data("content-shown")&&(e.find(n.mediaResultSelector).slideUp(),function(e){e.find("input[data-file]").removeAttr("checked"),e.find('[data-action="select"]').attr("disabled","disabled")}(e),e.data("content-shown",!1))}function r(e){e.preventDefault();const a=t.find(n.formSelector);f(a.attr("action")+"?"+a.serialize())}function d(e){e.preventDefault();f(l(this).attr("href"))}function f(e){l.get(e,(function(e){const a=l(e).find(n.resultsHolderSelector);l(t).find(n.resultsHolderSelector).replaceWith(a),h()}))}function p(e){const n=l(this).data("file");t.find('[data-action="select"][data-file='+n+"]").removeAttr("disabled")}function g(e){e.preventDefault();const a=t.find("input[data-file]").filter(":checked").val();""!==a&&n.onSelected&&l.get("/Admin/MediaSelector/GetFileInfo/",{value:a},(function(e){n.onSelected(e)}))}function h(){c=new u(t,{onFileUploadStopped:function(e,a){const i=t.find(n.formSelector);f(i.attr("action")+"?"+i.serialize()),a.removeAllFiles()}}),c.init()}return{show:function(e){a=this,l=e;const i=l("<a>").attr("href",n.selectorUrl);return i.hide(),i.featherlight({type:"iframe",iframeWidth:820,afterOpen:function(){t=l(".featherlight-inner").contents(),t.find("form").css("margin","0"),o(this.$instance),a.init()},beforeOpen:function(){l(".mrcms-edit-menu",document).hide()},onResize:function(){this.autoHeight&&(this.$content.css("height","10px"),this.$content.css("height",this.$content.contents().find("body")[0].scrollHeight)),o(this.$instance)}}).click().remove(),a},init:function(){return a=this,h(),l(t).on("click","div.header",(function(e){e.preventDefault();const a=l(this).find(n.mediaToggleSelector);a.length&&function(e){const a=e.data("media-toggle"),i=t.find("[data-file-result="+a+"]");t.find("[data-file-result]").not(i).each((function(){s(l(this))})),i.data("content-shown")?s(i):(i.find(n.mediaResultSelector).slideDown(),i.data("content-shown",!0))}(a)})),l(t).on("submit",n.formSelector,r),l(t).on("change","#CategoryId",r),l(t).on("keyup","#Query",(function(e){i&&clearTimeout(i),i=setTimeout((function(){r(e)}),300)})),l(t).on("click",".pagination a",d),l(t).on("click","input[data-file]",p),l(t).on("click",'[data-action="select"]',g),a},getSettings:function(){return n}}}function g(e,t){const n=e,a=$.extend(g.defaults,t);let i,o,c,l,s,r=!1;function d(){return n.val()}function u(e){const t=e.closest(".form-group");t.addClass("has-success"),t.find(".form-control-feedback").removeClass("hide"),clearTimeout(e.removeSuccess),e.removeSuccess=setTimeout((function(){t.removeClass("has-success"),t.find(".form-control-feedback").addClass("hide")}),2e3)}function f(e){const t=$(e.target);$.post(a.updateAltUrl,{url:t.data("url"),value:t.val()},(function(e){e&&u(t)}))}function p(e){const t=$(e.target);$.post(a.updateDescriptionUrl,{url:t.data("url"),value:t.val()},(function(e){e&&u(t)}))}function h(){if(function(){const e=d();return null!=e&&""!=e}()){const t=d();if(function(e){const t=e.split(".").pop().toLowerCase(),n=["jpg","jpeg","gif","png"];let a=!1;for(let e=0;e<n.length;e++)t==n[e]&&(a=!0);return a}(t)){const n=$("<div>").addClass("row media-preview"),i=$("<div>").addClass("col-auto pt-3");i.append($('<img src="'+t+'" class="img-fluid img-thumbnail" />')),i.append(s),n.append(i);const o=$("<div>").addClass("col pt-3"),c=function(t){const n=$("<div>").addClass("form-group has-feedback hide").attr("id",e.attr("id")+"-alt-holder"),i=e.attr("id")+"-alt",o=$("<label>").html("Alt").attr("for",i);n.append(o);const c=$("<input>").attr("type","text").addClass("form-control input-sm").attr("id",i).attr("data-url",t);n.append(c);const l=$('<span class="fa fa-ok form-control-feedback hide" aria-hidden="true"></span>');return n.append(l),$.get(a.altUrl,{url:t},(function(e){c.val(e.alt),n.removeClass("hide"),c.on("blur",f)})),n}(t);o.append(c);const l=function(t){const n=$("<div>").addClass("form-group has-feedback hide").attr("id",e.attr("id")+"-description-holder"),i=e.attr("id")+"-description",o=$("<label>").html("Description").attr("for",i);n.append(o);const c=$("<input>").addClass("form-control input-sm").attr("id",i).attr("data-url",t);n.append(c);const l=$('<span class="fa fa-ok form-control-feedback hide" aria-hidden="true"></span>');return n.append(l),$.get(a.descriptionUrl,{url:t},(function(e){c.val(e.description),n.removeClass("hide"),c.on("blur",p)})),n}(t);return o.append(l),n.append(o),n}return $("<span>"+t+"</span>")}return s.appendTo($("[data-media-selector-holder-"+e.attr("id")+"]")),$('<img src="'+a.noImageSelectedImage+'" style="'+a.previewStyle+'" />')}return{init:function(){if(i=this,n.is("input")){const t=$("<p>").attr("data-media-selector-holder-"+e.attr("id"),"true");s=$("<div>").addClass("d-flex mt-1").appendTo(t),o=$("<div>"),n.before(o),l=$("<button>").addClass(a.selectClasses).html(a.selectMessage).attr("data-media","select").appendTo(s),c=$("<button>").addClass(a.removeClasses).html(a.removeMessage).attr("data-media","remove").appendTo(s),n.hide().after(t),i.update(),i.registerEvents()}},registerEvents:function(){r||(l.click((function(e){e.preventDefault(),i.show()})),c.click((function(e){e.preventDefault(),i.reset()}))),r=!0},update:function(){const e=this.getValue();null!==e&&""!==e?(c.show(),s.addClass("btn-group")):(c.hide(),s.removeClass("btn-group"));const t=h();o.replaceWith(t),o=t},getValue:function(){return d()},setValue:function(e){n.val(e),i.update()},show:function(){new m({onSelected:i.onSelected,element:n,name:$(n).attr("id")}).show($)},reset:function(){i.setValue("")},onSelected:function(e){i.setValue(e.url),$.featherlight.close()}}}function h(e,t,n,a){t.html('<i class="fa fa-'+n+'"></i>'),e.addClass(a)}function b(e){const t=e.data("process-url"),n=e.find("[data-status]"),a=e.find("[ data-messages]");n.html("Processing"),$.get(t,(function(t){switch(t.status){case 0:!function(e,t){h(e,t,"check","table-success")}(e,n);break;case 1:!function(e,t){h(e,t,"remove","table-danger")}(e,n);break;case 2:!function(e,t){h(e,t,"asterisk","table-warning")}(e,n);break;case 3:!function(e,t){h(e,t,"minus","table-info")}(e,n)}!function(e,t){if(t.messages.length){const n=$("<ul>").addClass("list-unstyled mb-0");$.each(t.messages,(function(e,t){$("<li>").text(t).appendTo(n)})),n.appendTo(e)}}(a,t)}))}function v(e,t){const n="update-"+t,a="[data-"+n+"]";$(a).each((function(){const e=$(this);$.get(e.data(n),(function(t){e.replaceWith(t),window.admin.initializePlugins($(a))}))}))}g.defaults={noImageSelectedImage:"/Areas/Admin/Content/img/no-media-selected.jpg",previewStyle:"max-height: 200px; max-width:200px;",selectClasses:"btn btn-sm btn-success ",selectMessage:"Select media...",removeClasses:"btn btn-sm btn-danger ",removeMessage:"Remove media...",altUrl:"/admin/mediaselector/alt",updateAltUrl:"/admin/mediaselector/updatealt",descriptionUrl:"/admin/mediaselector/description",updateDescriptionUrl:"/admin/mediaselector/updatedescription"},m.defaults={selectorUrl:"/Admin/MediaSelector/Show",formSelector:"#search-form",resultsHolderSelector:"#results",mediaResultSelector:"[data-media-result]",mediaToggleSelector:"[data-media-toggle]",onSelected:function(e){}};let y="",w=0;function S(){const e=$("[data-add-webpage]");return{name:e.find("#Name").val(),mode:e.find("#mode").is(":checked"),webpageType:e.find("[name=WebpageType]:checked").val(),template:e.find("#PageTemplate_Id").val()}}const C=function(e){e.preventDefault(),function(){const e=y,t=S();return null===e||(e.webpageType!==t.webpageType||e.mode!==t.mode||e.name!==t.name||e.template!==t.template)}()&&function(){const e=$("[data-add-webpage]"),t=e.find("#Name").val(),n=e.find("[name=WebpageType]:checked").val(),a=e.find("#ParentId").val(),i=e.find("#PageTemplate_Id").val(),o=e.find("#mode").is(":checked");console.log(e.find("[name=WebpageType]:checked")),""!==t?($.get("/Admin/WebpageUrl/Suggest",{pageName:t,parentId:a,webpageType:n,template:i,useHierarchy:o},(function(t){e.find("#UrlSegment").val(t)})),y=S()):(e.find("#UrlSegment").val(""),y=S())}()};function k(e){clearTimeout(w),w=setTimeout((function(){C(e)}),300)}function T(e){e.preventDefault(),$(e.target).keyup()}function D(e){e.preventDefault(),y=S()}function F(e){const t=$("[data-add-webpage]");t.find(".hide-until-document-selected").show(),t.find("#message-choose-document").hide();const n=t.find(":radio[name=WebpageType]:checked"),a=n.val();$.get("/Admin/Webpage/AddProperties",{type:a,parentId:t.find("#Parent_Id").val()},(function(e){$("[data-additional-properties]").html(e),f()}));const i=n.data("page-template-id");t.find("#PageTemplateId").val(i)}function x(){$(document).on("focus","[data-add-webpage] #Name",D),$(document).on("blur","[data-add-webpage] #Name",T),$(document).on("keyup","[data-add-webpage] #Name",k),$(document).on("change","[data-add-webpage] #mode",k),$(document).on("change","[data-add-webpage] [name=WebpageType]",k),$(document).on("change","[data-add-webpage] #PageTemplate_Id",k),$(document).on("change","[data-add-webpage] :radio[name=WebpageType]",F);$("[data-add-webpage]").find(":radio[name=WebpageType]:checked").length&&F()}function A(e){let t=e.data.id;return null==t&&(t=""),t}function I(e){const t={};for(let n=0;n<menuRules.length;n++)menuRules[n](e,t);return t}function U(e,t,n){e.jstree({core:{animation:0,check_callback:!0,data:{url:n,data:function(e){return{id:e.id}},cache:!1}},state:{key:`${location.hostname}.${t}`},contextmenu:{items:I},plugins:["state","contextmenu"]}),e.on("click",".jstree-anchor",(function(e){const t=$(e.target),n=this.href;"fb-modal"==t.data("toggle")?c(n):location.href=n}))}function B(){$.validator.setDefaults({ignore:""});const e=$("[data-edit-webpage]");function t(){const t=e,n=t.find("#HasCustomPermissions"),a=t.find("[data-custom-permissions]"),i=a.find("#PermissionType");a.find("[data-custom-permissions-type]").hide();const o=n.is(":checked");if(a.toggle(o),!o)return;const c=i.val();a.find('[data-custom-permissions-type="'+c+'"]').show()}e.find("#UrlSegment").blur((function(e){const t=$(this);t.val(t.val().trim().replace(/[^a-zA-Z0-9-/]/g,"-"))})),e.find("#change-url").click((function(t){t.preventDefault(),e.find("#UrlSegment").removeAttr("disabled")})),e.find("#accordion-layout-areas").on("shown",(function(e){store.set("selected-layout-area-"+location.pathname,e.target.id)})),e.find("#accordion-layout-areas").on("hidden",(function(e){store.set("selected-layout-area-"+location.pathname,"")})),e.find("#PublishOn").change((function(){e.find("#publish-on-hidden").val($(this).val())})),e.find('.main-content a[data-toggle="tab"]').on("shown",(function(t){const n=t.target.toString();n.length>0&&-1!==n.indexOf("preview")&&e.find("#previewIframe").attr("src","/"+e.find("#LiveUrlSegment").val())})),$.get("/Admin/Role/GetRolesForPermissions",(function(t){e.find("#FrontEndRoles").tagit({autocomplete:{delay:0,minLength:0,source:t},availableTags:t,showAutocompleteOnFocus:!0,singleField:!0,placeholderText:"Click to add role."})})),e.find("#MetaKeywords").tagit({tagLimit:15,allowSpaces:!0}),e.on("change","#HasCustomPermissions",t),e.on("change","#PermissionType",t),t(),$(document).on("keypress",(function(t){13===t.which&&(e.find("#SEOTargetPhrase:focus").length&&(t.preventDefault(),e.find("[data-seo-analyze]").click()),e.find("input#Search:focus").length&&(t.preventDefault(),e.find("#search-postings").click()))})),$(document).on("click","[data-seo-analyze]",(function(t){t.preventDefault();const n=e.find("#SEOTargetPhrase").val();""===n?e.find("[data-seo-analysis-summary]").html("Please enter a term to analyze."):(e.find("[data-seo-analysis-summary]").html("Analyzing..."),$.get("/Admin/SEOAnalysis/Analyze",{id:e.find("#Id").val(),SEOTargetPhrase:n},(function(t){e.find("[data-seo-analysis-summary]").html(t)})))})),store.get("selected-layout-area-"+location.pathname)&&e.find('#accordion-layout-areas a[href="#'+store.get("selected-layout-area-"+location.pathname)+'"]').click()}function R(e){const t=$.extend({fileList:"#folder-container",folderClass:".folder",fileToolsContainer:"#file-tools",uiSelectedClass:".ui-selected",fileClass:".file",cutFilesBtn:"#cut-files",deleteFilesBtn:"#delete-files",pasteFilesBtn:"#paste-files",filesStorageKey:"files",cutFilesStorageKey:"cut-files",clearFilesBtn:"#clear-files",fileCutClass:".files-cut"},e);let n;return{init:function(){return n=this,$(document).on("initialize-plugins",(function(){$(t.fileList).selectable({filter:".file, .folder",stop:n.selectedStop,cancel:".ui-selected, ul.pagination a"})})),$(document).on("click",t.uiSelectedClass,(function(){$(this).removeClass("ui-selected").parents(".ui-selectable").trigger("selectablestop")})),$(document).on("dblclick",t.fileClass+","+t.folderClass,(function(){location.href=$(this).data("url")})),$(document).on("click",t.clearFilesBtn,(function(){n.clearSelectedFiles(),n.clearCutStyles(),n.setSelectedFileData(""),n.setCutFileData(""),n.disableCut(),n.disableDelete(),n.disablePaste()})),$(document).on("click",t.cutFilesBtn,(function(e){e.preventDefault(),n.clearCutStyles(),n.copyCutFilesToStorage()})),$(document).on("click",t.pasteFilesBtn,(function(e){e.preventDefault(),n.paste()})),$(document).on("click",t.deleteFilesBtn,(function(e){e.preventDefault(),swal({title:"Are you sure?",text:"Your will not be able to recover this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!0},(function(){n.deleteFiles()}))})),n.setSelectedFileData(""),n.setSelectedFiles(),n},deleteFiles:function(){const e=n.getSelectedFileData().split(",");let t=e.filter(P).join(",");t=O("file-","",t);let a=e.filter(z).join(",");a=O("folder-","",a),$.ajax({type:"POST",url:"/Admin/MediaCategory/DeleteFilesAndFolders",data:{files:t,folders:a},success:function(e){n.clearCutStyles(),n.clearSelectedFiles(),n.setSelectedFileData(""),n.setCutFileData(""),""!=e.message&&alert(e.message),n.setButtonState(),$(document).trigger("update-area","media-folder")}})},paste:function(){const e=n.getCutFileData().split(",");let t=e.filter(P).join(",");t=O("file-","",t);let a=e.filter(z).join(",");a=O("folder-","",a),$.ajax({type:"POST",url:"/Admin/MediaCategory/MoveFilesAndFolders",data:{folderId:$("#FolderId").val(),files:t,folders:a},success:function(e){n.clearCutStyles(),n.clearSelectedFiles(),n.setSelectedFileData(""),n.setCutFileData(""),""!=e.message&&alert(e.message),n.setButtonState(),$(document).trigger("update-area","media-folder")}})},copyCutFilesToStorage:function(){n.disableCut(),n.enablePaste(),n.setCutFileData(n.getSelectedFileData()),n.setOpacityOnCutFiles(n.getCutFileData())},setOpacityOnCutFiles:function(e){const t=e.split(",");$.each(t,(function(e){const n="[data-id='"+t[e]+"']";$(n).addClass("files-cut")}))},selectedStop:function(){const e=$(".file.ui-selected, .folder.ui-selected").map((function(){return $(this).data("id")})).get().join(",");n.setSelectedFileData(e),n.setButtonState()},setSelectedFiles:function(){const e=n.getSelectedFileData();let a;void 0!==e&&""!=e&&null!=e&&(a=e.split(","),$.each(a,(function(e){const n="[data-id='"+a[e]+"']";$(n).addClass(t.uiSelectedClass.replace(".",""))})));const i=n.getCutFileData();void 0!==i&&""!=i&&null!=i&&(a=i.split(","),$.each(a,(function(e){const n="[data-id='"+a[e]+"']";$(n).addClass(t.fileCutClass.replace(".",""))}))),n.setButtonState()},setButtonState:function(){n.disableCut(),n.disablePaste(),n.disableDelete(),(""!=n.getSelectedFileData()||""!=n.getSelectedFileData()&&""==n.getCutFileData())&&n.enableCut(),""!=n.getCutFileData()&&n.enablePaste(),n.enableDelete()},clearSelectedFiles:function(){$.each($(".file"+t.uiSelectedClass+", .folder"+t.uiSelectedClass),(function(){$(this).removeClass(t.uiSelectedClass.replace(".",""))}))},clearCutStyles:function(){$.each($(t.fileCutClass),(function(){$(this).removeClass(t.fileCutClass.replace(".",""))}))},getSelectedFileData:function(){return store.get(t.filesStorageKey)},getCutFileData:function(){return store.get(t.cutFilesStorageKey)},setSelectedFileData:function(e){store.set(t.filesStorageKey,e),n.setButtonState()},setCutFileData:function(e){store.set(t.cutFilesStorageKey,e),n.setButtonState()},enableCut:function(){$(t.cutFilesBtn).removeAttr("disabled")},disableCut:function(){$(t.cutFilesBtn).attr("disabled","disabled")},enableDelete:function(){$(".file.ui-selected, .folder.ui-selected").each((function(){$(t.deleteFilesBtn).removeAttr("disabled")}))},disableDelete:function(){$(t.deleteFilesBtn).attr("disabled","disabled")},enablePaste:function(){$(t.pasteFilesBtn).removeAttr("disabled")},disablePaste:function(){$(t.pasteFilesBtn).attr("disabled","disabled")}}}function P(e){return e.indexOf("file")>-1}function z(e){return e.indexOf("folder")>-1}function O(e,t,n){return n.replace(new RegExp(e,"g"),t)}function W(){$("[data-media-category]").each(((e,t)=>{R().init(),new u($(document),{}).init()}))}window.menuRules=[(e,t)=>{"True"===e.data.canAddChild&&(t.addMenuItem={label:"Add",action:()=>location.href="/Admin/"+e.data.controller+"/Add/"+A(e)})},(e,t)=>{"True"===e.data.sortable&&(t.sortMenuItem={label:"Sort",action:()=>location.href="/Admin/"+e.data.controller+"/Sort/"+function(e){let t=e.data.parentId;return null!=t&&0!==t||(t=""),t}(e)})},(e,t)=>{isNaN(e.id)||(t.editMenuItem={label:"Edit",action:()=>location.href="/Admin/"+e.data.controller+"/Edit/"+A(e)})},(e,t)=>{"True"===e.data.candelete&&(t.deleteMenuItem={label:"Delete",action:()=>c("/Admin/"+e.data.controller+"/Delete/"+A(e))})}],$((function(){})),$(window).on("load",(function(){}));const L="a[data-widget='pushmenu']",E="mrcms-push-menu-state",M="mrcms-admin-menu-items";function j(){const e=$(".menu-open").map((function(){return $(this).data("menu")})).get().join(",");store.set(M,e)}function N(){!function(){const e=(store.get(M)||"").split(",");for(let t=0;t<e.length;t++)$("li[data-menu='"+e[t]+"']").addClass("menu-open")}(),"collapsed"===store.get(E)&&!$("body").hasClass("sidebar-collapse")&&$(window).width()>992&&$(window).PushMenu("toggle"),function(){const e="ul#sidebar-nav";$(e).on("expanded.lte.treeview",(function(){j()})),$(e).on("collapsed.lte.treeview",(function(){j()})),$(L).on("collapsed.lte.pushmenu",(function(){store.set(E,"collapsed")})),$(L).on("shown.lte.pushmenu",(function(){store.set(E,"shown")}))}()}function H(){$("[data-stickytabs]").each((function(){!function(e){const t=$(e).data("stickytabs"),n=store.get(t);""!==location.hash&&$(e).find(` a[href="${location.hash}"]`).length>0?$(e).find(` a[href="${location.hash}"]`).tab("show"):n?$(e).find(`a[href="${n}"]`).tab("show"):$(e).find('li a[data-toggle="tab"]').length>0&&0==$(e).find('li.active a[data-toggle="tab"]').length&&$(e).find('a[data-toggle="tab"]').eq(0).click()}(this),$(this).on("shown.bs.tab",(function(e){!function(e){store.set($(e.currentTarget).data("stickytabs"),e.target.hash)}(e)}))}))}function K(){var e=document.getElementById("choose-avatar");if(e){var t="",n="",a=document.getElementById("avatar"),i=document.getElementById("image"),o=document.getElementById("input");e=document.getElementById("choose-avatar");var c,l=$(".progress"),s=($(".progress-bar"),$(".alert")),r=$("#modal");e.addEventListener("click",(function(e){e.preventDefault(),$(o).click()})),$('[data-toggle="tooltip"]').tooltip(),o.addEventListener("change",(function(e){var a,c,l=e.target.files,d=function(e){o.value="",i.src=e,s.hide(),r.modal("show")};l&&l.length>0&&(c=l[0],t=c.name,n=c.type,URL?d(URL.createObjectURL(c)):FileReader&&((a=new FileReader).onload=function(e){d(a.result)},a.readAsDataURL(c)))})),r.on("shown.bs.modal",(function(){c=new Cropper(i,{aspectRatio:1,viewMode:3})})).on("hidden.bs.modal",(function(){c.destroy(),c=null})),document.getElementById("crop").addEventListener("click",(function(){var e;r.modal("hide"),c&&(e=c.getCroppedCanvas({width:160,height:160}),a.src,a.src=e.toDataURL(),l.show(),s.removeClass("alert-success alert-warning"),e.toBlob((function(e){var n=new FormData($("#avatarForm")[0]);n.append("file",e,t),$.ajax({url:"/Admin/UserAvatar/Set",type:"POST",data:n,processData:!1,contentType:!1,success:function(e){s.show().addClass("alert-success").text("Upload success").fadeOut(),$(l).fadeOut(),window.location=$("#back-link").attr("href")}})}),n))}))}}function V(e){noty({text:'<div class="notification-date">'+e.date+'</div><div class="notification-msg">'+e.message+"</div>",layout:"bottomRight",timeout:5e3})}function _(){if("False"===$("body").data("disable-notifications")){const e=(new signalR.HubConnectionBuilder).withUrl("/notificationsHub").configureLogging(signalR.LogLevel.Warning).build();e.on("sendTransientNotification",V),e.start().catch((e=>console.error(e.toString())))}}function q(){const e=function(){const e=function(e,n=!0){if(i.prepend(t(e)),n){let t=l();for(t.push(e);t.length>25;)t.shift();c(t),o(t.length)}s()};let t=function(e){return $("<li>").addClass("list-group-item").attr("data-notification",!0).html('<div class="notification-date">'+e.date+'</div><div class="notification-msg">'+e.message+"</div>")},n=function(){i.empty(),i.append(r()),s()};const a=$("#persistentNotificationLink"),i=$("[data-notification-list]");let o=function(e){localStorage.setItem("notificationCount",e)},c=function(e){localStorage.setItem("notifications",JSON.stringify(e))},l=function(){return JSON.parse(localStorage.getItem("notifications"))||[]};const s=function(){let e=localStorage.getItem("notificationCount")||0;$("[data-notification-count]").html(e)},r=function(){return $('<li class="list-group-item">').html("No notifications")};return{init:function(){s(),a.on("hidden.bs.dropdown",(function(e){localStorage.removeItem("notifications"),localStorage.removeItem("notificationCount"),n()})),a.on("show.bs.dropdown",(function(t){!function(){let t=l();i.empty(),t.length?(t.reverse(),$.each(t,(function(t,n){e(n,!1)}))):n()}()}));const t=(new signalR.HubConnectionBuilder).withUrl("/notificationsHub").configureLogging(signalR.LogLevel.Warning).build();t.on("sendPersistentNotification",(function(t){e(t)})),t.start().catch((e=>console.error(e.toString())))}}};$((function(){"False"===$("body").data("disable-notifications")&&(new e).init()}))}function G(){0!==$("#add-media-category").length&&($.fn.delayKeyup=function(e,t){let n=0;const a=$(this);return $(this).keyup((function(){clearTimeout(n),n=setTimeout((function(){e(a)}),t)})),$(this)},$((function(){$("#Name").delayKeyup((function(){!function(){let e=$("#ParentUrl").val();""!==e&&(e+="/");$("#UrlSegment").val(e+$("#Name").val().trim().replace(/\W/g,"-").toLowerCase())}()}),100),$("form").validate()})))}function Q(){if(location.href.match(/Admin\/MessageTemplatePreview/)){var e=function(){function e(e){e.preventDefault();var t=$(e.target);$.get(t.attr("action"),{id:$("#id").val()},(function(e){$("#preview").html(e)}))}return{init:function(){$(document).on("submit","#preview-message-form",e)}}};$((function(){(new e).init()}))}}function J(e){e.preventDefault(),$.get("/admin/pageTemplate/getUrlGeneratorOptions",{type:$(e.target).val()},Y)}function Y(e){const t=$("[data-add-template-url-generator-type]");t.empty(),$.each(e,(function(e,n){t.append($("<option></option>").attr("value",n.value).text(n.text))}))}function Z(e){const t=$("#WidgetType").val();$.get("/Admin/Widget/AddProperties",{type:t},(function(e){$("[data-additional-properties]").html(e),admin.initializePlugins()}))}function X(e=document){$(e).find(".delete-file-simple").confirmation().on("click",(function(e){e.preventDefault(),function(e){const t=$(e).data("value");$.ajax({type:"POST",url:t,success:function(){const e=$(document).find("#file-list-simple");e&&$.get("/Admin/MediaCategory/ShowFilesSimple/"+e.data("category-id"),(function(t){$(e).replaceWith(t),X("#file-list-simple")}))}})}(e.target)}))}function ee(){function e(e){e.preventDefault();var t=$(e.target).val();$('[name^="sco-"]').val(t)}$((function(){$(document).on("change","#copy-all",e)}))}function te(e){$(e.target).removeAttr("target")}function ne(e){return e.loading?e.text:`${e.text} ${e.id.length?`(${e.id})`:""}`}function ae(e){return`${e.text} ${e.id.length?`(${e.id})`:""}`}function ie(){$("[data-webpage-search-select2]").each((function(e,t){!function(e){e.select2({placeholder:"Search for a webpage",minimumInputLength:1,ajax:{url:"/Admin/Webpage/Select2Search",data:function(e){return{term:e.term,page:e.page||1}},processResults:function(e,t){return t.page=t.page||1,{results:e.items,pagination:{more:10*t.page<e.total}}}},templateResult:ne,templateSelection:ae,escapeMarkup:function(e){return e}})}($(t))})),$(document).on("submit","[data-webpage-search-form]",oe)}function oe(e){e.preventDefault();let t=$(e.target);$.post(t.attr("action"),t.serialize(),(function(e){$("[data-webpage-search-results]").replaceWith(e)}))}function ce(){return $("[data-content-admin-blocks]")}function le(){return $("[data-content-admin-editor]")}function se(e){const t=ce();t.length&&(e=e??$("[data-content-admin-blocks-current]").data("content-admin-blocks-current")??t.data("content-admin-blocks"),$.get(e,(function(e){t.html(e),function(){const e=ce();if(!e.length)return;e.children("ul").sortable({handle:".sort-handle",update:function(t,n){let a=[];e.children("ul").children("li[data-order]").each((function(e,t){let n=e+1;$(t).data("order",n),a.push({id:$(t).data("id"),order:n})}));let i=e.children("ul").data("admin-blocks-order");$.post(i,{list:a}).done((function(e){we()})).fail((function(){se()}))}})}(),function(){const e=ce();if(!e.length)return;e.find("[data-content-admin-block-hide]").on("click",(function(){let e=$(this),t=e.data("content-admin-block-hide");$.post(t,{id:e.data("id")}).done((function(e){se(),we()}))}))}(),function(){const e=$("[data-admin-item-blocks-order]");if(!e.length)return;e.each((function(){$(this).sortable({handle:".child-sort-handle",update:function(e,t){let n=[],a=$(e.target).closest("[data-id]").data("id");$(e.target).children("li[data-id]").each((function(e,t){let a=e+1;n.push({id:$(t).data("id"),order:a})}));let i=$(e.target).data("admin-item-blocks-order");$.post(i,{id:a,list:n}).done((function(e){we()})).fail((function(){se()}))}})}))}()})))}function re(){const e=le();e.length&&(e.closest("[data-content-parent]").hasClass("expand")?fe():function(){const e=le();if(!e.length)return;e.closest("[data-content-parent]").addClass("expand"),$("[data-content-admin-expand-editor] [data-expand]").addClass("d-none"),$("[data-content-admin-expand-editor] [data-collapse]").removeClass("d-none")}())}function de(e){const t=le();if(t.length)if(e)t.closest("[data-content-parent]").removeClass("open"),fe(),$.get(e,(function(e){t.html(e),window.admin.initializePlugins(),t.closest("[data-content-parent]").addClass("open")}));else{t.closest("[data-content-parent]").removeClass("open"),fe(),ce().find("li.list-group-item-primary").removeClass("list-group-item-primary")}}function ue(){const e=le();if(!e.length)return;e.closest("[data-content-parent]").removeClass("open"),fe(),ce().find("li.list-group-item-primary").removeClass("list-group-item-primary")}function fe(){const e=le();e.length&&(e.closest("[data-content-parent]").removeClass("expand"),$("[data-content-admin-expand-editor] [data-expand]").removeClass("d-none"),$("[data-content-admin-expand-editor] [data-collapse]").addClass("d-none"))}function pe(e,t){const n=e.data(t);return!!n&&(se(n),!1)}function me(e){return pe($(e.currentTarget),"content-admin-block-open")}function ge(e){return pe($(e.currentTarget),"content-admin-block-close")}function he(e){const t=$(e.currentTarget);return function(e,t){const n=e.data(t);!!n&&de(n)}(t,"content-admin-editor"),pe(t,"content-admin-block-select"),!1}function $e(e){!function(e){let t=e.attr("data-id"),n=document.querySelector("[data-content-admin-preview-pane]");if(n){let e=n.contentDocument||n.contentWindow.document;if(e){let n=e.querySelector(`.mrcms-preview-block[data-content-block-id="${t}"]`);n&&($(n).addClass("highlight"),n.scrollIntoView({behavior:"smooth",block:"center"}))}}}($(e.currentTarget))}function be(e){!function(){let e=document.querySelector("[data-content-admin-preview-pane]");if(e){let t=e.contentDocument||e.contentWindow.document;if(t){let e=t.querySelectorAll(".mrcms-preview-block[data-content-block-id]");$(e).removeClass("highlight")}}}()}function ve(e){const t=$(e.currentTarget);if(confirm("Are you sure you want to delete this block?")){const e=t.data("content-admin-block-remove");$.post(e,(function(){se(),de(),we()}))}return!1}function ye(e){const t=$(e.currentTarget).data("content-admin-add-child");return $.post(t,(function(){se(),de(),we()})),!1}function we(){document.getElementById("content-admin-preview-pane").contentWindow.location.reload()}function Se(e){const t=$(e.currentTarget),n=t.serializeArray().reduceRight(((e,t)=>(e[t.name]=t.value,e)),{}),a=t.attr("action");return $.post(a,n,(function(){se(),de(),we()})),!1}function Ce(e){let t=new URL(this.src),n=this.contentWindow.location.href;n!==t.href&&(window.location=`/Admin/ContentVersion/EditByUrl?url=${n}`)}!function(){let e=$("body").data("antiforgery-token");$.ajaxSetup({cache:!1,headers:{RequestVerificationToken:e}})}(),$((()=>{var i;window.MediaSelector=m,$.fn.mediaSelector=function(e){const t={init:function(e){return this.each((function(){const t=$(this);t.hasClass("media-selector-initialized")||(new g(t,e).init(),t.addClass("media-selector-initialized"))}))}};return t[e]?t[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?$.error("Method "+e+" does not exist on mediaselector"):t.init.apply(this,arguments)},$.fn.mediaSelectorPopup=function(e){const t={init:function(e){return this.each((function(){const t=$(this),n=new m(t,e);n.init(),$.data(t[0],"media-selector",n),parent.$&&parent.$.data(t[0],"media-selector",n)}))}};return t[e]?t[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?$.error("Method "+e+" does not exist on mediaselector"):t.init.apply(this,arguments)},t(),$(document).ajaxStart((function(){$("#loading").show()})),$(document).ajaxStop((function(){$("#loading").hide()})),$().dropdown(),$("[rel='tooltip']").tooltip(),Globalize.culture($("body").data("current-ui-culture")),$.validator.methods.number=function(e,t){return this.optional(t)||!isNaN(Globalize.parseFloat(e))},$.validator.methods.date=function(e,t){return this.optional(t)||!isNaN(Globalize.parseDate(e))},$(document).on("click",'div[data-paging-type="async"] .pagination a[href]',n),$(document).on("click",'div[data-paging-type="async"] button[data-action=update]',a),l(),window.postToUrl=e,$(window).resize((function(){$(".modal").each((function(e,t){p($(t))}))})),window.resizeModal=p,$.fn.delayKeyup=function(e,t,n){let a=0;return $(this).keyup((function(e){clearTimeout(a),a=setTimeout((function(){t(e)}),n)})),$(this)},$("[data-health-check-list]").find("[data-process-url]").each((function(e,t){b($(t))})),$(document).on("update-area",v),x(),B(),$("[data-webpage-tree]").each(((e,t)=>{U($(t),"webpage-tree","/Admin/Navigation/WebSiteTree")})),$("[data-layout-tree]").each(((e,t)=>{U($(t),"layout-tree","/Admin/Navigation/LayoutTree")})),G(),d(),$.datepicker.setDefaults($.datepicker.regional[$("html").attr("lang")]),$(".datepicker").datepicker(),$(document).on("click",".date-time-picker",(function(){const e=$(this);if(!e.hasClass("hasDatepicker")){let t=$.datepicker._defaults.timeFormat;t||(t="HH:mm"),e.datetimepicker({timeFormat:t}).blur().focus()}})),W(),window.admin??={},window.admin.initializePlugins=f,_(),N(),H(),K(),$("[data-total-registrations]").each(((e,t)=>{const n=$(t).data("total-registrations"),a={type:"bar",data:{labels:n.map((e=>e.Date)),datasets:[{label:"Number of registrations",backgroundColor:"#007bff",borderColor:"#007bff",data:n.map((e=>e.Count))}]},options:{title:{display:!0,text:"User Registrations"},tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Date"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Count"},ticks:{beginAtZero:!0,precision:0}}]}}},i=t.getContext("2d");new Chart(i,a)})),q(),$("[data-action=post-link]").click((function(t){t.preventDefault();var n=$(this),a=n.attr("href")||n.data("link");null!=a&&e(a,{},"post")})),function(e){const t={source:function(t,n){const a=i.val();e.get("/Admin/TextSearch/QuickSearch",{term:t.term,type:a},n)},minLength:2,delay:400,select:function(e,t){var n;t.item&&(location.href=(n=t.item).actionUrl?n.actionUrl:"/Admin")}};let n,a,i;function o(t,n){let a=n.label;n.displayType&&(a+=" ("+n.displayType+")");const i=e("<a>").attr("href",n.actionUrl).html(a);return e("<li>").html(i).appendTo(t)}function c(t,n){const a=this;e.each(n,(function(n,i){n>0&&e("<li>").appendTo(t),a._renderItemData(t,i)}))}e((function(){a=e("[data-search-item-term]"),n=a.autocomplete(t).data("ui-autocomplete"),null!=n&&(n._renderItem=o,n._renderMenu=c),i=e("[data-search-item-type]"),i.on("change",(function(){a.trigger("focus")})),a.on("focus",(function(){n.search(e(this).val())}))}))}(jQuery),$((function(){var e=$(".submit-form-btn");e.length>0&&(e.on("click",(function(e){if($("form").valid()){e.preventDefault();let t=$(".form-update-form");$.post(t.attr("action"),t.serialize(),(function(e){if(e.success){var t=parent.$("#form-properties-data");$.get(t.data("reload-url"),(function(e){t.replaceWith(e),parent.$.featherlight.close()}))}else alert(e.message)}))}return!1})),$("form.form-update-form input").keypress((function(e){13===e.which&&(e.preventDefault(),$(".submit-form-btn").click())})))})),function(e){let t=jQuery("#Body");t.length>0&&t.hasClass("message-ckedit")&&CKEDITOR.replace("Body",{fullPage:!0,allowedContent:!0})}(),Q(),$(document).on("change","[data-add-template-page-type]",J),$("[data-form-sort-form] #sortable").sortable({update:function(e,t){$("#sortable li").each((function(e,t){$(t).find('[name*="Order"]').val(e)}))}}),$("[data-form-sort-form] #submit").click((function(e){e.preventDefault();const t=$("#sort-fields-form");$.ajax({data:t.serialize(),dataType:"json",url:"/Admin/Form/Sort",type:"POST",beforeSend:function(){},complete:function(){window.parent.location.reload(!1)},success:function(e){},error:function(e){}})})),$(document).on("change","[data-add-widget-form] #WidgetType",Z),$("[data-add-widget-form] #WidgetType").change(),ee(),i=function(){function e(e){a($("[data-batch-run-id="+e+"]"))}function t(t){var n=$(t.target).data("batch-run-id");$.post("/admin/batchrun/start/"+n,(function(){e(n)}))}function n(t){var n=$(t.target).data("batch-run-id");$.post("/admin/batchrun/pause/"+n,(function(){e(n)}))}function a(e){e.each((function(e,t){var n=$(t),a=n.data("refresh-url");a&&$.get(a,(function(e){n.replaceWith(e)}))}))}function i(e){a($("[data-batch-run-result-id="+e+"]"))}function o(e){var t=e.id;$("[data-batch-run-status="+t+"]").html(e.status);var n=e.completionStatus;$("[data-batch-run-progress-bar="+t+"]").css("width",n.percentageCompleted),$("[data-batch-run-progress-bar="+t+"]").length&&("Executing"===e.status?$("title").text(n.percentageCompleted+" Batch #"+t+" - Executing"):"Complete"===e.status&&$("title").text("Complete: Batch #"+t)),$("[data-batch-run-full-status="+t+"]").html(n.fullStatus),$("[data-batch-run-average-time-taken="+t+"]").html(n.averageTimeTaken),$("[data-batch-run-time-taken="+t+"]").html(n.timeTaken),$("[data-batch-run-pending="+t+"]").html(n.pending),$("[data-batch-run-succeeded="+t+"]").html(n.succeeded),$("[data-batch-run-time-remaining="+t+"]").html(n.estimatedTimeRemaining),$("[data-batch-run-failed="+t+"]").html(n.failed)}function c(e){a($("[data-batch-job-id="+e+"]"))}return{init:function(){$(document).on("click","[data-batch-run-start]",t),$(document).on("click","[data-batch-run-pause]",n);var a=(new signalR.HubConnectionBuilder).withUrl("/batchHub").configureLogging(signalR.LogLevel.Warning).build();a.start().catch((e=>console.error(e.toString()))),a.on("updateResult",i),a.on("updateRun",o),a.on("updateJob",c),a.on("refreshBatchRunUI",e)}}},$("[data-batch-run]").each(((e,t)=>{(new i).init()})),$(document).on("submit","#resource-choose-site",te),ie(),new u($(document),{}).init(),$.fn.select2.defaults.set("theme","bootstrap4"),Dropzone&&(Dropzone.autoDiscover=!1),$(document).on("click","a.more-link",(function(){return!1})),$(document).on("change","#admin-site-selector",(function(){location.href=$(this).val()})),f(),X(),se(),$(document).on("click","[data-content-admin-block-open]",me),$(document).on("click","[data-content-admin-block-close]",ge),$(document).on("click","[data-content-admin-block-select]",he),$(document).on("mouseenter","[data-content-admin-nav] li[data-id]",$e),$(document).on("mouseover","[data-content-admin-nav] li[data-id]",$e),$(document).on("mouseleave","[data-content-admin-nav] li[data-id]",be),$(document).on("click","[data-content-admin-block-remove]",ve),$(document).on("click","[data-content-admin-add-child]",ye),$(document).on("submit","[data-content-admin-save-editor]",Se),$(document).on("click","[data-content-admin-hide-editor]",ue),$(document).on("click","[data-content-admin-expand-editor]",re),$("[data-content-admin-preview-pane]").on("load",Ce)}))})();
//# sourceMappingURL=admin.js.map
