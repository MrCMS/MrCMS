@using System.Linq
@using MrCMS.Helpers
@using MrCMS.Services
@using MrCMS.Web.Apps.Admin.ACL
@using MrCMS.Web.Apps.Admin.Services
@model MrCMS.Web.Apps.Admin.Models.MediaCategorySearchModel
@inject IFileAdminService FileAdminService
@{
    Html.IncludeScript("~/Areas/Admin/scripts/media-uploader.js");
    Html.IncludeScript("~/Areas/Admin/scripts/media-category.js");
    Html.IncludeScript("~/Areas/Admin/scripts/media.js");
    var category = FileAdminService.GetCategory(Model);
    var sortByOptions = FileAdminService.GetSortByOptions(Model);
    bool canAccessMediaToolsCut = Html.CanAccess<MediaToolsACL>(MediaToolsACL.Cut);
    bool canAccessMediaToolsDelete = Html.CanAccess<MediaToolsACL>(MediaToolsACL.Delete);
}

<div class="mb-3">
    <partial name="Upload" model="category"/>
</div>

@if (category != null)
{
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a href="@Url.Action("Index", "MediaCategory")">@Html.Resource("Admin Media", "Media")</a>
        </li>
        @foreach (var folder in category.BreadCrumbs.Reverse())
        {
            <li class="breadcrumb-item">
                <a href="@Url.Action("Show", "MediaCategory", new {Id = folder.Id})">@folder.Name</a>
            </li>
        }
    </ol>
}

@using (Html.BeginForm(FormMethod.Get, new {}))
{
    <div class="row">
        <div class="col-sm-6">
            <div class="form-group">
                @Html.LabelFor(model => model.SearchText)
                @Html.TextBoxFor(model => model.SearchText, new {@class = "form-control"})
            </div>
        </div>
        <div class="col-sm-4">
            <div class="form-group">
                @Html.LabelFor(model => model.SortBy)
                @Html.DropDownListFor(model => model.SortBy, sortByOptions, new {@class = "form-control"})
            </div>
        </div>
        <div class="col-sm-2">
            <div class="form-group">
                <label class="hidden-xs">&nbsp;</label>
                <button type="submit" class="btn btn-outline-primary form-control">@Html.Resource("Search")</button>
            </div>
        </div>
    </div>
}

@if (canAccessMediaToolsCut || canAccessMediaToolsDelete)
{
    <span class="btn-group mb-3" id="file-tools">
        @{
            if (canAccessMediaToolsCut)
            {
                <button id="cut-files" class="btn btn-secondary" disabled>@Html.Resource("Cut")</button>
            }
            <button id="paste-files" class="btn btn-secondary" disabled>@Html.Resource("Paste")</button>
            if (canAccessMediaToolsDelete)
            {
                <button id="delete-files" class="btn btn-secondary" disabled>@Html.Resource("Delete")</button>
            }
            <button id="clear-files" class="btn btn-secondary">@Html.Resource("Clear")</button>
        }
    </span>
}

<partial name="Directory" model="Model"/>