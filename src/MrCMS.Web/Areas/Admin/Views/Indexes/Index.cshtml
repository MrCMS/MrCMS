@using MrCMS.Helpers
@using MrCMS.Models
@model System.Collections.Generic.List<MrCMS.Models.MrCMSIndex>
@{
    ViewBag.Title = "Indexes";
    var universalSearchIndexInfo = ViewData["universal-search-index-info"] as MrCMSIndex;
}


<admin-header>
    <row>
        <admin-header-title title="@Html.Resource("admin-indexes", "Indexes")"/>

        <admin-header-actions>
        </admin-header-actions>
    </row>
</admin-header>

<card>
    <card-body>
        <table class="table table-striped table-condensed">
            <tr>
                <th>
                    @Html.Resource("admin-name", "Name")
                </th>
                <th>
                    @Html.Resource("Admin Indexes Index Exists", "Index Exists")?
                </th>
                <th>
                    @Html.Resource("Admin Indexes Number Of Documents", "Number of docs")
                </th>
                <th></th>
            </tr>
            @foreach (var index in Model)
            {
                <tr>
                    <td>
                        @index.Name
                    </td>
                    <td>
                        @index.DoesIndexExist
                    </td>
                    <td>
                        @(index.NumberOfDocs.HasValue ? index.NumberOfDocs.ToString() : "-")
                    </td>
                    <td>
                        <div class="btn-group">
                            @if (index.DoesIndexExist)
                            {
                                @Html.FormLink(Html.Resource("Admin Indexes Reindex", "Reindex"), "Reindex", new {type = index.TypeName}, new {@class = "btn btn-sm btn-secondary"})
                            }
                            else
                            {
                                @Html.FormLink(Html.Resource("Admin Indexes Create", "Create"), "Create", new {type = index.TypeName}, new {@class = "btn btn-sm btn-secondary"})
                            }


                            @Html.ActionLink(Html.Resource("Admin Indexes Set Boosts", "Set Boosts"), "Boosts", "Indexes", new {type = index.TypeName}, new {@class = "btn btn-sm btn-secondary", data_toggle = "fb-modal"})
                        </div>
                    </td>
                </tr>
            }
        </table>

    </card-body>
</card>


<form asp-controller="Indexes" asp-action="ReindexUniversalSearch" method="post">

    <admin-header>
        <row>
            <admin-header-title title="@Html.Resource("admin-universal-search-index", "Universal Search Index") "/>

            <admin-header-actions>
                <button class="btn btn-secondary" type="submit">@Html.Resource("Admin Indexes Reindex Universal Search Button", "Reindex Universal Search")</button>
            </admin-header-actions>
        </row>
    </admin-header>

    <card>
        <card-body>
            @if (universalSearchIndexInfo != null)
            {
                <strong>Exists:</strong>
                @universalSearchIndexInfo.DoesIndexExist
                <br/>
                if (universalSearchIndexInfo.DoesIndexExist)
                {
                    <strong>Number of records:</strong>
                    @universalSearchIndexInfo.NumberOfDocs
                    <br/>
                }
            }
        </card-body>
    </card>
</form>
